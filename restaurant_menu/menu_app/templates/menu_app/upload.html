<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload PDF</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script>
        async function uploadPDF(event) {
            event.preventDefault();  // Prevent the default form submission

            const form = document.querySelector('form');
            const formData = new FormData(form);

            try {
                // Send the form data to the server
                const response = await fetch("{% url 'pdf_upload' %}", {
                    method: "POST",
                    body: formData,
                    headers: {
                        "X-CSRFToken": "{{ csrf_token }}",  // Include CSRF token
                    },
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    document.getElementById('error_message').innerText = errorData.error_message;
                    return;
                }

                const data = await response.json();
                document.getElementById('message').innerText = data.message;
                document.getElementById('output').innerText = data.output;

                // renderJson(data.output);
                // document.getElementById('output').innerText = data.output;

            } catch (error) {
                console.error("Error uploading PDF:", error);
                document.getElementById('error_message').innerText = "An unexpected error occurred.";
            }
        }
    </script>
</head>
<body>
    <header class="header">
        <div class="container flex justify-between items-center">
            <nav>
                <ul class="navbar">
                    <li><a href="{%url 'home' %}">Home</a></li>
                    <li><a href="{%url 'about' %}">About</a></li>
                    <li><a href="{% url 'pdf_upload' %}">Upload a Menu</a></li>
                    <li><a href="{% url 'view_uploads' %}">View Menus</a></li>
                </ul>                
            </nav>
        </div>
    </header>

    <div id="general">
        <h1>Upload Menu PDF</h1>

        <p id="error_message" style="color:red;"></p>
        <p id="message" style="color:green;"></p>
        <!-- Additional parameters:
                Restuarant info: restuarant name, (OPTIONAL): address, phone_number, email, and website 
                Menu info: 'description' (change to name; leave other stuff), description of menu entry
        -->

        <form method="POST" enctype="multipart/form-data" onsubmit="uploadPDF(event)">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" id="uploadButton">Upload</button>
        </form>

        <!-- Change to be user friendly: if true then ..., false then ... -->
        <p>Response:</p>
        <div id="output"></div>
    </div>
    

    <footer class="footer">
        <div class="container">
            <nav>
                <ul class="git">
                    <li><a href="https://github.com/studentBorisGans/menuDatabase.git">GitHub</a></li>
                    <li><a href="https://github.com/studentBorisGans/menuDatabase.git">Documentation</a></li>
                </ul>
            </nav>
        </div>
    </footer>
</body>
</html>