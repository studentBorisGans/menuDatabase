<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inspect Menu</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <script>
        const menuId = {{ menu_id }};
    </script>
    <style>
        /* Embedded styling for elements */
        .menu-info-container {
            margin: 20px auto;
            padding: 20px;
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .menu-header {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 15px;
            text-align: center;
        }

        .menu-data p {
            margin: 8px 0;
        }

        .section {
            margin: 20px 0;
            padding: 15px;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .section h3 {
            margin-bottom: 10px;
            font-size: 1.2rem;
            color: #1e40af;
        }

        .menu-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background-color: #fff;
            border: 1px solid #e0e0e0;
        }

        .menu-table th,
        .menu-table td {
            border: 1px solid #e0e0e0;
            padding: 10px;
            text-align: left;
        }

        .menu-table th {
            background-color: #1e40af;
            color: white;
        }

        .menu-table tbody tr:nth-child(even) {
            background-color: #f1faff;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container flex justify-between items-center">
            <nav>
                <ul class="navbar">
                    <li><a href="{% url 'home' %}">Home</a></li>
                    <li><a href="{% url 'about' %}">About</a></li>
                    <li><a href="{% url 'pdf_upload' %}">Upload a Menu</a></li>
                    <li><a href="{% url 'view_uploads' %}">View Menus</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <h1>Inspect Menu</h1>
        <div class="menu-info-container" id="menu-container">
            <!-- General menu information -->
        </div>
        <div id="sections-container">
            <!-- Sections will be dynamically added here -->
        </div>
    </main>

    <!-- JavaScript -->
    <script>
        const menuContainer = document.getElementById('menu-container');
        const sectionsContainer = document.getElementById('sections-container');

        // Fetch menu data
        fetch(`/menu_version/${menuId}/data/`)
            .then(response => response.json())
            .then(data => {
                // Populate general menu information
                menuContainer.innerHTML = `
                    <div class="menu-data">
                        <p><strong>Version Number:</strong> ${data.version_number}</p>
                        <p><strong>Created At:</strong> ${data.created_at}</p>
                        <p><strong>Status:</strong> ${data.status}</p>
                        <p><strong>Error Message:</strong> ${data.error_message || 'None'}</p>
                        <p><strong>Description:</strong> ${data.description || 'No description provided.'}</p>
                        <p><strong>Average Menu Price:</strong> $${data.avg_menu_price.toFixed(2)}</p>
                    </div>
                `;

                // Iterate through sections
                if (data.sections && data.sections.length > 0) {
                    data.sections.forEach(section => {
                        const sectionDiv = document.createElement('div');
                        sectionDiv.className = 'section';

                        // Add section name and average section price
                        sectionDiv.innerHTML = `
                            <h3>${section.section_name}</h3>
                            <p><strong>Average Section Price:</strong> $${section.avg_section_price.toFixed(2)}</p>
                        `;

                        // Add table for menu items
                        const table = document.createElement('table');
                        table.className = 'menu-table';

                        table.innerHTML = `
                            <thead>
                                <tr>
                                    <th>Menu Item</th>
                                    <th>Price</th>
                                    <th>Dietary Restriction</th>
                                    <th>Description</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${section.menu_items.map(item => `
                                    <tr>
                                        <td>${item.menu_item || 'N/A'}</td>
                                        <td>${item.price ? `$${item.price}` : 'N/A'}</td>
                                        <td>${item.dietary_restriction || 'None'}</td>
                                        <td>${item.description || 'No description available'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        `;
                        sectionDiv.appendChild(table);
                        sectionsContainer.appendChild(sectionDiv);
                    });
                } else {
                    // Fallback for no sections
                    sectionsContainer.innerHTML = '<p>No sections available for this menu.</p>';
                }
            })
            .catch(error => {
                console.error('Error fetching menu data:', error);
                menuContainer.innerHTML = '<p>Failed to load menu data.</p>';
            });
    </script>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <nav>
                <ul class="git">
                    <li><a href="https://github.com/studentBorisGans/menuDatabase.git">GitHub</a></li>
                    <li><a href="https://github.com/studentBorisGans/menuDatabase.git">Documentation</a></li>
                </ul>
            </nav>
        </div>
    </footer>
</body>
</html>
